<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
    <title>æ–°å¹´å¿«ä¹</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{width:100vw;height:100vh;background:#000;overflow:hidden;position:relative;-webkit-tap-highlight-color:transparent;}
        /* å¯¹è”ï¼šå›ºå®šä½ç½®ï¼Œä¸ºæ–‡å­—ç•™å‡ºä¸­é—´åŒºåŸŸ */
        .hp{position:absolute;top:2vw;left:0;right:0;text-align:center;font-size:10vw;color:#FF0000;font-weight:900;text-shadow:0 0 2vw #FF0000;z-index:5;opacity:1;}
        .left{position:absolute;left:1vw;top:50%;transform:translateY(-50%);font-size:10vw;color:#FF0000;font-weight:900;writing-mode:vertical-rl;letter-spacing:2vw;text-shadow:0 0 2vw #FF0000;z-index:5;opacity:1;}
        .right{position:absolute;right:1vw;top:50%;transform:translateY(-50%);font-size:10vw;color:#FF0000;font-weight:900;writing-mode:vertical-rl;letter-spacing:2vw;text-shadow:0 0 2vw #FF0000;z-index:5;opacity:1;}
        /* æŒ‰é’®ï¼šä¸Šç§»ä¸é®æŒ¡å¯¹è”ä¸­é—´åŒºåŸŸ */
        #fireBtn{ position:absolute;
                    top:calc(6vw + 30px); /* ä½äº.hpå…ƒç´ ä¸‹æ–¹30px */
                    left:50%;
                    transform:translate(-50%, 0); /* æ°´å¹³å±…ä¸­å¯¹é½ */
                    width:60vw;
                    height:18vw;
                    line-height:18vw;
                    text-align:center;
                    background:#000;
                    color:#FFD700;
                    border:1.2vw solid #FFD700;
                    border-radius:12vw;
                    font-size:7vw;
                    font-weight:900;
                    cursor:pointer;
                    box-shadow:0 0 8vw #FFD700;
                    z-index:999;}
        /* ç”»å¸ƒï¼šå…¨å±è¦†ç›–ï¼Œå±‚çº§ä½äºå¯¹è”ä½†é«˜äºèƒŒæ™¯ */
        #canvas{position:absolute;top:0;left:0;width:100vw;height:100vh;z-index:2;}
    </style>
</head>
<body>
    <div class="hp">é©¬å¹´å¦‚æ„</div>
    <div class="left">éªé©¬å¥”è…¾æ·»å–œæ°”</div>
    <div class="right">çº¢å¦†ä¿ä¸½å±•æ¬¢é¢œ</div>
    <button id="fireBtn">ç‚¹æˆ‘æ”¾çƒŸèŠ±ğŸ†</button>
    <audio id="bgMusic" loop autoplay>
        <source src="fafh.MP3" type="audio/mp3">
    </audio>
    <canvas id="canvas"></canvas>

    <script>
        window.onload = function() {
            const btn = document.getElementById('fireBtn');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            let W = window.innerWidth, H = window.innerHeight;
            canvas.width = W;
            canvas.height = H;
            let isFired = false;
            let textParticles = []; // ç”¨äºå½¢æˆæ–‡å­—çš„ç²’å­
            let fireworksParticles = []; // æ™®é€šçƒŸèŠ±ç²’å­
            const targetText = "æ–°æ˜¥å¿«ä¹--ZZ";
            
            // ä½¿ç”¨æŒ‰é’®çš„å­—ä½“å¤§å°
            const fontSize = 7 * (W / 100); // ä¸æŒ‰é’®çš„font-size:7vwä¿æŒä¸€è‡´
            let textPos = [];
            // æ·»åŠ æ–‡å­—è¾¹ç•Œæ¡†å­˜å‚¨
            let textBoundingBox = { left: 0, right: 0, top: 0, bottom: 0 };
            let fireStartTime = 0;
            const EXPLOSION_TIME = 1200; // çˆ†ç‚¸é˜¶æ®µæŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            const FORMATION_TIME = 2000; // æ–‡å­—å½¢æˆæ€»æ—¶é—´
            let isTextFormed = false; // æ–‡å­—æ˜¯å¦å·²ç»å½¢æˆå®Œæˆ
            
            // è£…é¥°å…ƒç´ ï¼šç¯ç¬¼å’Œé‡‘å…ƒå®
            let decorations = [];
            const LANTERN_COUNT = 8; // ç¯ç¬¼æ•°é‡
            const INGOT_COUNT = 12; // é‡‘å…ƒå®æ•°é‡
            
            // éšæœºçƒŸèŠ±é…ç½®
            const FIREWORKS_INTERVAL = 800; // éšæœºçƒŸèŠ±ç”Ÿæˆé—´éš”ï¼ˆæ¯«ç§’ï¼‰
            let fireworksTimer = null; // éšæœºçƒŸèŠ±å®šæ—¶å™¨
            
            // å°è¯•æ’­æ”¾éŸ³ä¹ï¼ˆå¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
            const bgMusic = document.getElementById('bgMusic');
            bgMusic.play().catch(err => {
                console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', err);
            });

            // å±å¹•é€‚é…ï¼šæ—‹è½¬/ç¼©æ”¾åé‡æ–°è®¡ç®—æ–‡å­—ä½ç½®
            window.onresize = () => {
                W = window.innerWidth;
                H = window.innerHeight;
                canvas.width = W;
                canvas.height = H;
                createTextPos();
                createDecorations(); // é‡æ–°ç”Ÿæˆè£…é¥°å…ƒç´ ä½ç½®
            };

            // æ–‡å­—ä½ç½®å’Œå¤§å°ä¸æŒ‰é’®ä¸€è‡´
            function createTextPos() {
                textPos = [];
                const offscreenCanvas = document.createElement('canvas');
                const offscreenCtx = offscreenCanvas.getContext('2d');
                offscreenCanvas.width = W;
                offscreenCanvas.height = H;
                
                // ä½¿ç”¨åæ–‡ç»†é»‘å­—ä½“
                offscreenCtx.font = `normal ${fontSize}px "STXihei", "åæ–‡ç»†é»‘", é»‘ä½“, SimHei, sans-serif`;
                
                // å°†æ–‡æœ¬ä½ç½®è®¾ç½®ä¸ºå±å¹•ä¸­å¿ƒ
                const textX = W / 2; // æ°´å¹³å±…ä¸­
                const textY = H / 2; // å‚ç›´å±…ä¸­
                
                // ç»˜åˆ¶æ–‡å­—
                offscreenCtx.fillStyle = "#FFFFFF";
                offscreenCtx.textAlign = "center";
                offscreenCtx.textBaseline = "middle";
                offscreenCtx.fillText(targetText, textX, textY);
                
                // è®¡ç®—æ–‡å­—è¾¹ç•Œæ¡†
                const metrics = offscreenCtx.measureText(targetText);
                const textHeight = fontSize; // ä¼°ç®—æ–‡å­—é«˜åº¦
                textBoundingBox = {
                    left: textX - metrics.width / 2,
                    right: textX + metrics.width / 2,
                    top: textY - textHeight / 2,
                    bottom: textY + textHeight / 2
                };
                
                // é‡‡é›†æ–‡å­—ä½ç½® - å¢åŠ é‡‡é›†é—´éš”ï¼Œå‡å°‘é‡å½±
                const sampleInterval = Math.ceil(fontSize / 12); // æ ¹æ®å­—ä½“å¤§å°åŠ¨æ€è°ƒæ•´é‡‡é›†é—´éš”
                const imageData = offscreenCtx.getImageData(0, 0, W, H).data;
                
                for (let y = 0; y < H; y += sampleInterval) {
                    for (let x = 0; x < W; x += sampleInterval) {
                        const index = (y * W + x) * 4;
                        if (imageData[index + 3] > 200) {
                            textPos.push({ x, y });
                        }
                    }
                }
            }

            // æ£€æŸ¥ä½ç½®æ˜¯å¦æœ‰æ•ˆï¼ˆä¸åœ¨æ–‡å­—åŒºåŸŸå†…ï¼‰
            function isPositionValid(x, y, size) {
                const margin = size * 2;
                return !(
                    x + margin > textBoundingBox.left &&
                    x - margin < textBoundingBox.right &&
                    y + margin > textBoundingBox.top &&
                    y - margin < textBoundingBox.bottom
                );
            }

            // åˆ›å»ºè£…é¥°å…ƒç´ ï¼šç¯ç¬¼å’Œé‡‘å…ƒå®
            function createDecorations() {
                decorations = [];
                
                // åˆ›å»ºç¯ç¬¼
                for (let i = 0; i < LANTERN_COUNT; i++) {
                    let x, y, size;
                    let attempts = 0;
                    do {
                        x = Math.random() * W;
                        y = Math.random() * H;
                        size = Math.random() * 20 + 10;
                        attempts++;
                    } while (!isPositionValid(x, y, size) && attempts < 100);
                    
                    decorations.push({
                        type: 'lantern',
                        x,
                        y,
                        size,
                        rotation: Math.random() * Math.PI * 2,
                        alpha: Math.random() * 0.5 + 0.5
                    });
                }
                
                // åˆ›å»ºé‡‘å…ƒå®
                for (let i = 0; i < INGOT_COUNT; i++) {
                    let x, y, size;
                    let attempts = 0;
                    do {
                        x = Math.random() * W;
                        y = Math.random() * H;
                        size = Math.random() * 15 + 8;
                        attempts++;
                    } while (!isPositionValid(x, y, size) && attempts < 100);
                    
                    decorations.push({
                        type: 'ingot',
                        x,
                        y,
                        size,
                        rotation: Math.random() * Math.PI * 2,
                        alpha: Math.random() * 0.5 + 0.5
                    });
                }
            }

            // ç»˜åˆ¶ç¯ç¬¼
            function drawLantern(x, y, size, rotation, alpha) {
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.translate(x, y);
                ctx.rotate(rotation);
                
                // ç¯ç¬¼ä¸»ä½“ - ä½¿ç”¨å‚ç›´æ¤­åœ†
                const bodyGradient = ctx.createLinearGradient(-size/2, -size, size/2, size);
                bodyGradient.addColorStop(0, '#CC0000');
                bodyGradient.addColorStop(0.5, '#FF0000');
                bodyGradient.addColorStop(1, '#CC0000');
                
                ctx.fillStyle = bodyGradient;
                ctx.beginPath();
                ctx.ellipse(0, 0, size/3, size, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // ç¯ç¬¼å¤–æ¡†
                ctx.strokeStyle = '#8B0000';
                ctx.lineWidth = size/20;
                ctx.beginPath();
                ctx.ellipse(0, 0, size/3, size, 0, 0, Math.PI * 2);
                ctx.stroke();
                
                // ç¯ç¬¼é¡¶éƒ¨é’©å­
                ctx.fillStyle = '#8B0000';
                ctx.beginPath();
                ctx.moveTo(-size/8, -size);
                ctx.quadraticCurveTo(0, -size - size/5, size/8, -size);
                ctx.fill();
                
                // ç¯ç¬¼åº•éƒ¨
                ctx.beginPath();
                ctx.moveTo(-size/8, size);
                ctx.lineTo(size/8, size);
                ctx.closePath();
                ctx.fill();
                
                // ç¯ç¬¼ç©—å­
                const tasselGradient = ctx.createLinearGradient(-size/6, size + size/8, size/6, size + size/2);
                tasselGradient.addColorStop(0, '#FFD700');
                tasselGradient.addColorStop(0.5, '#FFA500');
                tasselGradient.addColorStop(1, '#FFD700');
                
                ctx.fillStyle = tasselGradient;
                ctx.beginPath();
                ctx.moveTo(0, size + size/8);
                ctx.lineTo(-size/8, size + size/2);
                ctx.lineTo(size/8, size + size/2);
                ctx.closePath();
                ctx.fill();
                
                // ç¯ç¬¼è£…é¥°çº¿æ¡
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = size/30;
                for(let i = -4; i <= 4; i++) {
                    const yPos = (i * size/5) - size/10;
                    ctx.beginPath();
                    ctx.moveTo(-size/4, yPos);
                    ctx.lineTo(size/4, yPos);
                    ctx.stroke();
                }
                
                ctx.restore();
            }
            
            // ç»˜åˆ¶é‡‘å…ƒå®
            function drawIngot(x, y, size, rotation, alpha) {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(rotation);
                
                // é‡‘å…ƒå®ä¸»ä½“
                const gradient = ctx.createLinearGradient(-size, -size/2, size, size/2);
                gradient.addColorStop(0, '#FFD700');
                gradient.addColorStop(0.4, '#FFA500');
                gradient.addColorStop(0.5, '#FFD700');
                gradient.addColorStop(0.6, '#FFA500');
                gradient.addColorStop(1, '#FFD700');
                
                ctx.fillStyle = gradient;
                
                // ç»˜åˆ¶ä¼ ç»Ÿé‡‘å…ƒå®å½¢çŠ¶
                ctx.beginPath();
                ctx.moveTo(-size/2, -size/3);
                ctx.bezierCurveTo(-size, -size/3, -size, size/3, -size/2, size/3);
                ctx.lineTo(0, size);
                ctx.lineTo(size/2, size/3);
                ctx.bezierCurveTo(size, size/3, size, -size/3, size/2, -size/3);
                ctx.lineTo(0, -size);
                ctx.closePath();
                ctx.fill();
                
                // é‡‘å…ƒå®è¾¹æ¡†
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = size/20;
                ctx.stroke();
                
                // é«˜å…‰æ•ˆæœ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.beginPath();
                ctx.moveTo(-size/4, -size/4);
                ctx.lineTo(0, size/2);
                ctx.lineTo(size/4, size/4);
                ctx.bezierCurveTo(size/3, size/6, size/3, -size/6, size/4, -size/4);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            }

            // æ–‡å­—ç²’å­ç±»
            class TextParticle {
                constructor(explosionX = W/2, explosionY = H/2) {
                    this.x = explosionX; // ç²’å­ä»æŒ‡å®šä½ç½®çˆ†ç‚¸
                    this.y = explosionY;
                    // çˆ†ç‚¸é€Ÿåº¦é€‚é…æ‰‹æœº
                    const speed = Math.min(W*0.08, 28) * Math.random(); // éšæœºé€Ÿåº¦å¤§å°
                    const angle = Math.random() * Math.PI * 2; // éšæœºè§’åº¦ï¼ˆ0åˆ°2Ï€ï¼‰
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                    this.gravity = 0.02; // å¢åŠ é‡åŠ›å½±å“ï¼Œä½¿çˆ†ç‚¸æ•ˆæœæ›´çœŸå®
                    this.alpha = 1;
                    this.color = "#FFD700"; // çº¯é»„é‡‘è‰²ï¼Œå¯¹æ¯”é»‘åº•æ›´é†’ç›®
                    this.size = Math.min(W*0.007, 2.5); // å‡å°ç²’å­å°ºå¯¸ï¼Œæé«˜æ¸…æ™°åº¦
                    
                    // ç«‹å³åˆ†é…ç›®æ ‡ä½ç½®ï¼Œè€Œä¸æ˜¯ç­‰åˆ°æ±‡èšé˜¶æ®µ
                    this.target = this.assignTarget();
                    this.formationProgress = 0; // æ–‡å­—å½¢æˆè¿›åº¦ï¼ˆ0-1ï¼‰
                }

                assignTarget() {
                    if(textPos.length > 0) {
                        const idx = Math.floor(Math.random()*textPos.length);
                        const target = textPos[idx];
                        textPos.splice(idx, 1);
                        return target;
                    }
                    // å¦‚æœæ²¡æœ‰ç›®æ ‡ä½ç½®ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªåœ¨å±å¹•ä¸­å¿ƒé™„è¿‘çš„ä½ç½®
                    const textX = W/2;
                    const textY = H/2;
                    return {
                        x: textX + (Math.random() - 0.5) * fontSize * 3,
                        y: textY + (Math.random() - 0.5) * fontSize
                    };
                }

                update() {
                    const now = Date.now();
                    const diff = now - fireStartTime;
                    
                    // è®¡ç®—æ–‡å­—å½¢æˆè¿›åº¦ï¼ˆ0-1ï¼‰
                    this.formationProgress = Math.min(diff / FORMATION_TIME, 1);
                    
                    if(diff < EXPLOSION_TIME) {
                        // çˆ†ç‚¸é˜¶æ®µï¼šç²’å­å‘å¤–æ‰©æ•£
                        this.vy += this.gravity;
                        this.x += this.vx;
                        this.y += this.vy;
                        this.alpha = 1;
                    } else if(diff < FORMATION_TIME) {
                        if(this.target) {
                            const dx = this.target.x - this.x;
                            const dy = this.target.y - this.y;
                            
                            // è®¡ç®—è·ç¦»ï¼Œä½¿ç²’å­åŠ é€Ÿå‘ç›®æ ‡ç§»åŠ¨
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            const moveSpeed = 0.05; // ç§»åŠ¨é€Ÿåº¦ç³»æ•°
                            
                            this.vx += (dx / distance) * moveSpeed;
                            this.vy += (dy / distance) * moveSpeed;
                            
                            // æ·»åŠ é˜»å°¼æ•ˆæœï¼Œä½¿ç²’å­é€æ¸å‡é€Ÿ
                            this.vx *= 0.95;
                            this.vy *= 0.95;
                            
                            this.x += this.vx;
                            this.y += this.vy;
                        }
                        
                        this.alpha = 1;
                    } else {
                        // å½¢æˆå®Œæˆåå›ºå®šåœ¨ç›®æ ‡ä½ç½®
                        if(this.target) {
                            this.x = this.target.x;
                            this.y = this.target.y;
                        }
                        this.vx = 0;
                        this.vy = 0;
                    }
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
                    ctx.restore();
                }
            }

            // æ™®é€šçƒŸèŠ±ç²’å­ç±»
            class FireworkParticle {
                constructor(explosionX, explosionY) {
                    this.x = explosionX;
                    this.y = explosionY;
                    // éšæœºçˆ†ç‚¸é€Ÿåº¦
                    const speed = Math.min(W*0.06, 22) * Math.random();
                    const angle = Math.random() * Math.PI * 2;
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                    this.gravity = 0.03;
                    this.alpha = 1;
                    // éšæœºçƒŸèŠ±é¢œè‰²
                    const colors = ["#FFD700", "#FF0000", "#FFA500", "#FFFF00", "#00FF00", "#00FFFF", "#FF00FF"];
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                    this.size = Math.min(W*0.005, 2.0);
                    this.life = Math.random() * 30 + 40; // ç²’å­ç”Ÿå‘½å‘¨æœŸ
                    this.maxLife = this.life;
                }

                update() {
                    this.vy += this.gravity;
                    this.x += this.vx;
                    this.y += this.vy;
                    this.life--;
                    this.alpha = this.life / this.maxLife;
                    
                    // æ·»åŠ ç©ºæ°”é˜»åŠ›
                    this.vx *= 0.98;
                    this.vy *= 0.98;
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                    ctx.restore();
                }

                isDead() {
                    return this.life <= 0;
                }
            }

            // å¸§æ¸²æŸ“ï¼šæµç•…æ— å¡é¡¿ï¼Œæ–‡å­—å§‹ç»ˆåœ¨å¯¹è”ä¸­é—´
            function render() {
                ctx.clearRect(0,0,W,H);
                
                // ç»˜åˆ¶è£…é¥°å…ƒç´ ï¼ˆèƒŒæ™¯å±‚ï¼‰
                decorations.forEach(decoration => {
                    if(decoration.type === 'lantern') {
                        drawLantern(decoration.x, decoration.y, decoration.size, decoration.rotation, decoration.alpha);
                    } else if(decoration.type === 'ingot') {
                        drawIngot(decoration.x, decoration.y, decoration.size, decoration.rotation, decoration.alpha);
                    }
                });
                
                // ç»˜åˆ¶æ–‡å­—ç²’å­ï¼šåªåœ¨æ–‡å­—å½¢æˆè¿‡ç¨‹ä¸­æ˜¾ç¤ºï¼Œå®Œæˆåéšè—
                if (isFired) {
                    const now = Date.now();
                    const diff = now - fireStartTime;
                    
                    // åªåœ¨å½¢æˆè¿‡ç¨‹ä¸­ç»˜åˆ¶ç²’å­ï¼ˆçˆ†ç‚¸å’Œæ±‡èšé˜¶æ®µï¼‰
                    if (diff < FORMATION_TIME) {
                        textParticles.forEach(p => {
                            p.update();
                            p.draw();
                        });
                    } else if (!isTextFormed) {
                        // æ–‡å­—åˆšåˆšå½¢æˆå®Œæˆ
                        isTextFormed = true;
                        startRandomFireworks(); // å¼€å§‹ç”ŸæˆéšæœºçƒŸèŠ±
                    }
                }

                // ç»˜åˆ¶å®ä½“å­—ä½“
                if (isFired) {
                    const now = Date.now();
                    const diff = now - fireStartTime;
                    if (diff >= FORMATION_TIME) { // ç²’å­ç³»ç»Ÿå®Œæˆåç»˜åˆ¶å®ä½“æ–‡å­—
                        ctx.save();
                        ctx.font = `normal ${fontSize}px "STXihei", "åæ–‡ç»†é»‘", é»‘ä½“, SimHei, sans-serif`;
                        ctx.fillStyle = "#FFD700"; // ä¸ç²’å­é¢œè‰²ç›¸åŒ
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillText(targetText, W/2, H/2);
                        ctx.restore();
                    }
                }

                // ç»˜åˆ¶å¹¶æ›´æ–°æ™®é€šçƒŸèŠ±ç²’å­
                for (let i = fireworksParticles.length - 1; i >= 0; i--) {
                    const particle = fireworksParticles[i];
                    particle.update();
                    particle.draw();
                    
                    if (particle.isDead()) {
                        fireworksParticles.splice(i, 1);
                    }
                }
                
                requestAnimationFrame(render);
            }

            // åˆ›å»ºæ–‡å­—ç²’å­
            function createTextParticles(explosionX = W/2, explosionY = H/2) {
                // å‡å°‘ç²’å­æ•°é‡ï¼Œé¿å…é‡å½±
                const particleNum = Math.min(400, textPos.length);
                for(let i=0; i<particleNum; i++) {
                    textParticles.push(new TextParticle(explosionX, explosionY));
                }
            }

            // åˆ›å»ºéšæœºçƒŸèŠ±
            function createRandomFirework() {
                // ç”Ÿæˆéšæœºä½ç½®ï¼ˆé¿å¼€æ–‡å­—åŒºåŸŸï¼‰
                let x, y;
                const margin = 50; // æ–‡å­—åŒºåŸŸè¾¹ç¼˜ç•™ç™½
                
                // å°è¯•50æ¬¡æ‰¾åˆ°åˆé€‚çš„ä½ç½®
                for (let attempt = 0; attempt < 50; attempt++) {
                    x = Math.random() * (W - margin * 2) + margin;
                    y = Math.random() * (H - margin * 2) + margin;
                    
                    // æ£€æŸ¥æ˜¯å¦åœ¨æ–‡å­—åŒºåŸŸå†…
                    if (!isPositionValid(x, y, 10)) {
                        continue;
                    }
                    
                    break; // æ‰¾åˆ°åˆé€‚çš„ä½ç½®
                }
                
                // åˆ›å»ºçƒŸèŠ±ç²’å­ï¼ˆ60-120ä¸ªç²’å­ï¼‰
                const particleCount = Math.floor(Math.random() * 60) + 60;
                for (let i = 0; i < particleCount; i++) {
                    fireworksParticles.push(new FireworkParticle(x, y));
                }
            }

            // å¼€å§‹ç”ŸæˆéšæœºçƒŸèŠ±
            function startRandomFireworks() {
                // ç«‹å³ç”Ÿæˆä¸€ä¸ªçƒŸèŠ±
                createRandomFirework();
                
                // è®¾ç½®å®šæ—¶å™¨ï¼Œå®šæœŸç”ŸæˆéšæœºçƒŸèŠ±
                fireworksTimer = setInterval(() => {
                    createRandomFirework();
                }, FIREWORKS_INTERVAL);
            }

            // åœæ­¢ç”ŸæˆéšæœºçƒŸèŠ±
            function stopRandomFireworks() {
                if (fireworksTimer) {
                    clearInterval(fireworksTimer);
                    fireworksTimer = null;
                }
            }

            // æ‰‹æœºç«¯è§¦æ§ä¼˜åŒ–ï¼šæ”¯æŒç‚¹å‡»/è§¦æ‘¸ï¼Œé˜²è¯¯è§¦
            btn.addEventListener('click', () => {
                fire();
            });
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                fire();
            });

            // ä¿®æ”¹ï¼šæ·»åŠ ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®è§¦å‘çƒŸèŠ±çš„åŠŸèƒ½
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (!isFired) {
                    fire(x, y);
                } else if (isTextFormed) {
                    // æ–‡å­—å·²ç»å½¢æˆï¼Œç‚¹å‡»å±å¹•ç”ŸæˆçƒŸèŠ±
                    createRandomFirework();
                }
            });

            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                
                if (!isFired) {
                    fire(x, y);
                } else if (isTextFormed) {
                    // æ–‡å­—å·²ç»å½¢æˆï¼Œç‚¹å‡»å±å¹•ç”ŸæˆçƒŸèŠ±
                    createRandomFirework();
                }
            });

            // ä¸»è§¦å‘å‡½æ•°
            function fire(explosionX = W/2, explosionY = H/2) {
                if(isFired) return;
                isFired = true;
                btn.style.display = 'none';
                fireStartTime = Date.now();
                
                // ç”Ÿæˆæ–‡å­—ä½ç½®
                createTextPos();
                
                // åˆ›å»ºç²’å­ï¼Œä¼ å…¥çˆ†ç‚¸ä½ç½®
                createTextParticles(explosionX, explosionY);
            }

            // åˆå§‹åŒ–
            createDecorations();
            render();
        };
    </script>
</body>
</html>